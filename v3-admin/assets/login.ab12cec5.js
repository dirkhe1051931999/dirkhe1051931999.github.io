var R=Object.defineProperty;var U=(i,t,e)=>t in i?R(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>(U(i,typeof t!="symbol"?t+"":t,e),e);import{_ as P,d as S,o as I,c as V,F as o,ag as D,w,aH as k,v as T,bx as M,g as _,ao as A,b,e as L,aP as X,a as q,X as H,aQ as $,am as N,an as Y,aS as j}from"./vendor.274cf1c6.js";import{s as B,U as Q,aT as z}from"./common.fcce7b8d.js";function F(){return"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z".split(",")}function v(i,t){return Math.floor(Math.random()*(t-i)+i)}function C(i,t){const e=v(i,t),n=v(i,t),s=v(i,t);return`rgb(${e},${n},${s})`}class W{constructor(t){h(this,"options",{domId:"",canvasId:"verifyCanvas",width:"100",height:"30",type:"blend",code:"",numArr:[],letterArr:[]});if(!t)throw new Error("invalid dom ID");this.options.domId=t,this.init(),this.refresh()}init(){this.options.numArr="0,1,2,3,4,5,6,7,8,9".split(","),this.options.letterArr=F();const t=document.getElementById(this.options.domId);if(!t)throw new Error("invalid dom");const e=document.createElement("canvas");this.options.width=t.offsetWidth>0?t.offsetWidth:"100",this.options.height=t.offsetHeight>0?t.offsetHeight:"30",e.id=this.options.canvasId,e.width=this.options.width,e.height=this.options.height,e.style.cursor="pointer",e.innerHTML="\u60A8\u7684\u6D4F\u89C8\u5668\u7248\u672C\u4E0D\u652F\u6301canvas",t.appendChild(e),e.onclick=()=>{this.refresh()}}refresh(){const t=document.getElementById(this.options.canvasId);let e,n;if(this.options.code="",!!t.getContext){e=t.getContext("2d"),e.textBaseline="middle",e.fillStyle=C(180,240),e.fillRect(0,0,this.options.width,this.options.height),this.options.type=="blend"?n=this.options.numArr.concat(this.options.letterArr):this.options.type=="number"?n=this.options.numArr:n=this.options.letterArr;for(let s=1;s<=4;s++){const l=n[v(0,n.length)];this.options.code+=l,e.font=`${v(this.options.height/2,this.options.height)}px SimHei`,e.fillStyle=C(50,160),e.shadowOffsetX=v(-3,3),e.shadowOffsetY=v(-3,3),e.shadowBlur=v(-3,3),e.shadowColor="rgba(0, 0, 0, 0.3)";const a=this.options.width/5*s,u=this.options.height/2,d=v(-30,30);e.translate(a,u),e.rotate(d*Math.PI/180),e.fillText(l,0,0),e.rotate(-d*Math.PI/180),e.translate(-a,-u)}for(let s=0;s<4;s++)e.strokeStyle=C(40,180),e.beginPath(),e.moveTo(v(0,this.options.width),v(0,this.options.height)),e.lineTo(v(0,this.options.width),v(0,this.options.height)),e.stroke();for(let s=0;s<this.options.width/4;s++)e.fillStyle=C(0,255),e.beginPath(),e.arc(v(0,this.options.width),v(0,this.options.height),1,0,2*Math.PI),e.fill()}}validate(t){t=t.toLowerCase();const e=this.options.code.toLowerCase();return t==e}}class G{constructor(t,e){h(this,"option",{width:280,height:155,PI:Math.PI,sliderL:42,sliderR:9,offset:5,loadingText:"Loading...",failedText:"Refresh",barText:"Swipe right to fill the puzzle",maxLoadCount:3,localImages:()=>"/866-536x354.jpg",verify:(t,e)=>!0,remoteUrl:null,outSrc:"",onRefresh:()=>{},onSuccess:()=>{},onFail:()=>{}});h(this,"canvasOption",{});h(this,"$element");this.$element=t,this.option=Object.assign({},this.option,e),this.$element.style.position="relative",this.$element.style.width=`${this.option.width}px`,this.$element.style.margin="0 auto",this.init()}init(){this.initDOM(),this.initImg(),this.bindEvents()}initDOM(){const t=(g,m)=>{const y=document.createElement(g);return y.className=m,y},n=((g,m)=>{const y=document.createElement("canvas");return y.width=g,y.height=m,y})(this.option.width-2,this.option.height),s=n.cloneNode(!0),l=t("div","sliderContainer"),a=t("i","refreshIcon "),u=t("div","sliderMask"),d=t("div","sliderbg"),c=t("div","slider"),r=t("i",""),p=t("span","sliderText");s.className="slidercaptcha-block",p.innerHTML=this.option.barText,a.innerHTML="Refresh",r.innerHTML="\u2192";const f=this.$element;f.appendChild(n),f.appendChild(a),f.appendChild(s),c.appendChild(r),u.appendChild(c),l.appendChild(d),l.appendChild(u),l.appendChild(p),f.appendChild(l),Object.assign(this.canvasOption,{canvas:n,block:s,sliderContainer:l,refreshIcon:a,slider:c,sliderMask:u,sliderIcon:r,text:p,canvasCtx:n.getContext("2d"),blockCtx:s.getContext("2d"),x:0})}initImg(){let t,e,n="";const s=window.navigator.userAgent.indexOf("Trident")>-1,l=this.option.sliderL+this.option.sliderR*2+3,a=(r,p)=>{const f=this.option.sliderL,g=this.option.sliderR,m=this.option.PI;r.beginPath(),r.moveTo(t,e),r.arc(t+f/2,e-g+2,g,.72*m,2.26*m),r.lineTo(t+f,e),r.arc(t+f+g-2,e+f/2,g,1.21*m,2.78*m),r.lineTo(t+f,e+f),r.lineTo(t,e+f),r.arc(t+g-2,e+f/2,g+.4,2.76*m,1.24*m,!0),r.lineTo(t,e),r.lineWidth=2,r.fillStyle="rgba(255, 255, 255, 0.7)",r.strokeStyle="rgba(255, 255, 255, 0.7)",r.stroke(),r[p](),r.globalCompositeOperation=s?"xor":"destination-over"},u=(r,p)=>Math.round(Math.random()*(p-r)+r),d=new Image;d.crossOrigin="Anonymous";let c=0;d.onload=()=>{this.canvasOption.x=t=u(l+10,this.option.width-(l+10)),e=u(10+this.option.sliderR*2,this.option.height-(l+10)),a(this.canvasOption.canvasCtx,"fill"),a(this.canvasOption.blockCtx,"clip"),this.canvasOption.canvasCtx.drawImage(d,0,0,this.option.width-2,this.option.height),this.canvasOption.blockCtx.drawImage(d,0,0,this.option.width-2,this.option.height);const r=e-this.option.sliderR*2-1,p=this.canvasOption.blockCtx.getImageData(t-3,r,l,l);this.canvasOption.block.width=l,this.canvasOption.blockCtx.putImageData(p,0,r+1),this.canvasOption.text.textContent=this.canvasOption.text.getAttribute("data-text")},d.onerror=()=>{if(c++,window.location.protocol==="file:")throw c=this.option.maxLoadCount,new Error("can't load pic resource file from File protocal. Please try http or https");if(c>=this.option.maxLoadCount){this.canvasOption.text.textContent="Image failed to load",this.canvasOption.text.classList.add("text-red");return}d.src=this.option.localImages()},this.option.outSrc&&(n=this.option.outSrc),d.src=n,this.canvasOption.text.setAttribute("data-text",this.option.barText),this.canvasOption.text.textContent=this.option.loadingText}bindEvents(){this.$element.addEventListener("selectstart",()=>!1),this.canvasOption.refreshIcon.addEventListener("click",()=>{this.canvasOption.text.textContent=this.option.barText,this.reset(),this.option.onRefresh.call(this.$element)});let t,e,n=[],s=!1;const l=d=>{this.canvasOption.text.classList.contains("text-danger")||(t=d.clientX||d.touches[0].clientX,e=d.clientY||d.touches[0].clientY,s=!0)},a=d=>{if(!s)return!1;const c=d.clientX||d.touches[0].clientX,r=d.clientY||d.touches[0].clientY,p=c-t,f=r-e;if(p<0||p+40>this.option.width)return!1;this.canvasOption.slider.style.left=`${p-1}px`;const g=(this.option.width-40-20)/(this.option.width-40)*p;this.canvasOption.block.style.left=`${g}px`,this.canvasOption.sliderContainer.classList.add("sliderContainer_active"),this.canvasOption.sliderMask.style.width=`${p+4}px`,n.push(Math.round(f))},u=d=>{if(!s||(s=!1,(d.clientX||d.changedTouches[0].clientX)===t))return!1;this.canvasOption.sliderContainer.classList.remove("sliderContainer_active"),this.canvasOption.trail=n;const r=this.verify();r.spliced&&r.verified?(this.canvasOption.sliderContainer.classList.add("sliderContainer_success"),this.option.onSuccess.call(this.$element)):(this.canvasOption.sliderContainer.classList.add("sliderContainer_fail"),this.option.onFail.call(this.$element),setTimeout(()=>{this.canvasOption.text.innerHTML=this.option.failedText,this.reset()},1e3))};this.canvasOption.slider.addEventListener("mousedown",l),this.canvasOption.slider.addEventListener("touchstart",l),document.addEventListener("mousemove",a),document.addEventListener("touchmove",a),document.addEventListener("mouseup",u),document.addEventListener("touchend",u),document.addEventListener("mousedown",()=>!1),document.addEventListener("touchstart",()=>!1),document.addEventListener("swipe",()=>!1)}clean(){this.canvasOption.canvasCtx.clearRect(0,0,this.option.width,this.option.height),this.canvasOption.blockCtx.clearRect(0,0,this.option.width,this.option.height),this.canvasOption.block.width=this.option.width}verify(){const t=this.canvasOption.trail,e=parseInt(this.canvasOption.block.style.left);let n=!1;if(this.option.remoteUrl!==null)n=this.option.verify(t,this.option.remoteUrl);else{const s=function(c,r){return c+r},l=function(c){return c*c},a=t.reduce(s)/t.length,u=t.map(c=>c-a);n=Math.sqrt(u.map(l).reduce(s)/t.length)!==0}return{spliced:Math.abs(e-this.canvasOption.x)<this.option.offset,verified:n}}reset(){this.canvasOption.sliderContainer.classList.remove("sliderContainer_fail"),this.canvasOption.sliderContainer.classList.remove("sliderContainer_success"),this.canvasOption.slider.style.left=0,this.canvasOption.block.style.left=0,this.canvasOption.sliderMask.style.width=0,this.clean(),this.canvasOption.text.setAttribute("data-text",this.canvasOption.text.textContent),this.canvasOption.text.textContent=this.option.loadingText,this.initImg()}}var J=Object.defineProperty,K=Object.getOwnPropertyDescriptor,E=(i,t,e,n)=>{for(var s=n>1?void 0:n?K(t,e):t,l=i.length-1,a;l>=0;l--)(a=i[l])&&(s=(n?a(t,e,s):a(s))||s);return n&&s&&J(t,e,s),s};let O=class extends S.Vue{constructor(){super(...arguments);h(this,"verifyCodeInstance");h(this,"otherQuery",{});h(this,"username","admin");h(this,"password","123456");h(this,"verifyCode","");h(this,"redirect");h(this,"PrdTitle",B.title);h(this,"useVerifyCode",!1);h(this,"useSwipeVerifyCode",!1);h(this,"showUseSwipeVerifyCode",!1);h(this,"lockShowUseSwipeVerifyCode",!1)}onRouteChange(t){const e=t.query;e&&(this.redirect=e.redirect,this.otherQuery=this.getOtherQuery(e))}created(){}mounted(){try{this.verifyCodeInstance=new W("verify-code-login")}catch(t){console.log(t)}}getOtherQuery(t){return Object.keys(t).reduce((e,n)=>(n!=="redirect"&&(e[n]=t[n]),e),{})}async handLogin(){let t=!0;if(this.useVerifyCode&&(t=this.verifyCodeInstance.validate(this.verifyCode)),!t){this.$globalMessage.show({type:"error",content:"Wrong verification code"});return}const e=async()=>{this.$q.loading.show(),await Q.Login({username:this.username,password:this.password}),this.$q.loading.hide(),this.useSwipeVerifyCode=!1,this.useVerifyCode=!1,this.$globalMessage.show({type:"success",content:this.$t("messages.success")}),await z(500),location.reload()};if(this.useSwipeVerifyCode){if(!this.lockShowUseSwipeVerifyCode){this.lockShowUseSwipeVerifyCode=!0,this.showUseSwipeVerifyCode=!0;var n=new G(document.querySelector("#captcha"),{id:"captcha",onSuccess:()=>{var s=setTimeout(()=>{this.showUseSwipeVerifyCode=!1,this.lockShowUseSwipeVerifyCode=!1,window.clearTimeout(s),n.reset(),e()},500)}})}}else e()}};E([S.Watch("$route",{immediate:!0})],O.prototype,"onRouteChange",1);O=E([S.Component({name:"LoginPage"})],O);const Z=O,x=i=>(N("data-v-754759cd"),i=i(),Y(),i),tt={class:"login-root"},et={class:"box-root flex-flex flex-direction--column",style:{"min-height":"100vh","flex-grow":"1"}},it=q(`<div class="loginbackground padding-top--64" data-v-754759cd><div class="loginbackground-gridContainer" data-v-754759cd><div class="box-root flex-flex" style="grid-area:top / start / 8 / end;" data-v-754759cd><div class="box-root" style="background-image:linear-gradient(\r
                    white 0%,\r
                    rgb(247, 250, 252) 33%\r
                  );flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:4 / 2 / auto / 5;" data-v-754759cd><div class="box-root box-divider--light-all-2 animationLeftRight tans3s" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:6 / start / auto / 2;" data-v-754759cd><div class="box-root box-background--blue800" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:7 / start / auto / 4;" data-v-754759cd><div class="box-root box-background--blue animationLeftRight" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:8 / 4 / auto / 6;" data-v-754759cd><div class="box-root box-background--gray100 animationLeftRight tans3s" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:2 / 15 / auto / end;" data-v-754759cd><div class="box-root box-background--cyan200 animationRightLeft tans4s" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:3 / 14 / auto / end;" data-v-754759cd><div class="box-root box-background--blue animationRightLeft" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:4 / 17 / auto / 20;" data-v-754759cd><div class="box-root box-background--gray100 animationRightLeft tans4s" style="flex-grow:1;" data-v-754759cd></div></div><div class="box-root flex-flex" style="grid-area:5 / 14 / auto / 17;" data-v-754759cd><div class="box-root box-divider--light-all-2 animationRightLeft tans3s" style="flex-grow:1;" data-v-754759cd></div></div></div></div>`,1),ot={class:"box-root padding-top--24 flex-flex flex-direction--column",style:{"flex-grow":"1","z-index":"9"}},st={class:"box-root padding-top--48 padding-bottom--24 flex-flex flex-justifyContent--center"},nt={class:"text-primary bg-gradient-primary text-gradient"},at={class:"formbg-outer"},rt={class:"formbg"},dt={class:"formbg-inner padding-horizontal--48"},lt=x(()=>o("span",{class:"padding-bottom--15"},"Sign in to your account",-1)),ct={id:"stripe-login"},ht={class:"field padding-bottom--24"},pt=x(()=>o("label",{for:"email"},"Username",-1)),ft={class:"field padding-bottom--24"},vt=x(()=>o("div",{class:"grid--50-50"},[o("label",{for:"password"},"Password"),o("div",{class:"reset-pass"},[o("a",{href:"#"},"Forgot your password?")])],-1)),ut={class:"field padding-bottom--24"},gt=x(()=>o("label",{for:"verifyCode"},"Code",-1)),mt={class:"flex justify-between"},xt=x(()=>o("div",{id:"verify-code-login",style:{width:"40%",height:"44px"}},null,-1)),wt={class:"field field-checkbox padding-bottom--24 flex-flex align-center"},yt={class:"field field-checkbox padding-bottom--24 flex-flex align-center"},bt={class:"field padding-bottom--24"},Ct=x(()=>o("div",{class:"field"},[o("a",{class:"ssolink",href:"#"},"Use single sign-on (Google) instead")],-1)),_t={class:"footer-link padding-top--24"},Ot=x(()=>o("span",null,[_(" Don't have an account? "),o("a",{href:"#"},"Sign up")],-1)),kt={class:"listing padding-top--24 padding-bottom--24 flex-flex center-center"},Lt=x(()=>o("span",null,[o("a",{href:"https://dirkhe1051931999.github.io/quasar/",target:"__blank",class:"bg-gradient-primary text-gradient"},"vue2 with quasar and use vue-class-decorator")],-1)),St={class:"useSwipeVerifyCode"},It=x(()=>o("div",{class:"text-h6"},"Use swipe verification code to verify",-1)),Vt=x(()=>o("div",{id:"captcha"},null,-1));function Tt(i,t,e,n,s,l){return I(),V("div",null,[o("div",tt,[o("div",et,[it,o("div",ot,[o("div",st,[o("h3",nt,D(i.PrdTitle),1)]),o("div",at,[o("div",rt,[o("div",dt,[lt,o("form",ct,[o("div",ht,[pt,w(o("input",{type:"text",name:"email",autocapitalize:"off","onUpdate:modelValue":t[0]||(t[0]=a=>i.username=a),autocomplete:"new-password"},null,512),[[k,i.username]])]),o("div",ft,[vt,w(o("input",{type:"text",name:"password",class:"input-password","onUpdate:modelValue":t[1]||(t[1]=a=>i.password=a),autocapitalize:"off",autocomplete:"new-password"},null,512),[[k,i.password]])]),w(o("div",ut,[gt,o("div",mt,[w(o("input",{type:"text",name:"verifyCode","onUpdate:modelValue":t[2]||(t[2]=a=>i.verifyCode=a),autocapitalize:"off",style:{width:"55%",height:"100%"},autocomplete:"new-password"},null,512),[[k,i.verifyCode]]),xt])],512),[[T,i.useVerifyCode]]),o("div",wt,[o("label",{for:"checkbox",onClick:t[4]||(t[4]=a=>i.useSwipeVerifyCode=!i.useSwipeVerifyCode)},[w(o("input",{type:"checkbox",name:"checkbox","onUpdate:modelValue":t[3]||(t[3]=a=>i.useSwipeVerifyCode=a)},null,512),[[M,i.useSwipeVerifyCode]]),_(" Use swipe verification code to verify? ")])]),o("div",yt,[o("label",{for:"checkbox",onClick:t[6]||(t[6]=a=>i.useVerifyCode=!i.useVerifyCode)},[w(o("input",{type:"checkbox",name:"checkbox","onUpdate:modelValue":t[5]||(t[5]=a=>i.useVerifyCode=a)},null,512),[[M,i.useVerifyCode]]),_(" Use verification code to verify? ")])]),o("div",bt,[w((I(),V("div",{class:"login-submit-button bg-gradient-primary",onClick:t[7]||(t[7]=A((...a)=>i.handLogin&&i.handLogin(...a),["prevent"]))},[_(" Login ")])),[[j]])]),Ct])])]),o("div",_t,[Ot,o("div",kt,[Lt,b(H,{name:"arrow_forward_ios",class:"fs-18 text-primary bg-gradient-primary text-gradient"})])])])])])]),w(o("div",St,[b(X,null,{default:L(()=>[b($,null,{default:L(()=>[It]),_:1}),b($,{class:"q-pt-none"},{default:L(()=>[Vt]),_:1})]),_:1})],512),[[T,i.showUseSwipeVerifyCode]])])}var Rt=P(Z,[["render",Tt],["__scopeId","data-v-754759cd"]]);export{Rt as default};
