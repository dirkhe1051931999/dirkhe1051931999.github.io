import{cw as z,ct as x}from"./vendor.274cf1c6.js";import{u as c,A as y,d as q,i as F,C as v,a as f,V as L,m as P,b as B,c as V,t as W,f as $,e as K}from"./axios.00a583eb.js";import{g as O}from"./shared/axios/main.61673788.js";import{A as X,U as T,s as A,aX as k}from"./common.fcce7b8d.js";class M{constructor(){this.handlers=[]}use(r,s,t){return this.handlers.push({fulfilled:r,rejected:s,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){c.forEach(this.handlers,function(t){t!==null&&r(t)})}}function C(e,r){const s=this||q,t=r||s,n=y.from(t.headers);let a=t.data;return c.forEach(e,function(i){a=i.call(s,a,n.normalize(),r?r.status:void 0)}),n.normalize(),a}function S(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new v}function D(e){return S(e),e.headers=y.from(e.headers),e.data=C.call(e,e.transformRequest),(e.adapter||q.adapter)(e).then(function(t){return S(e),t.data=C.call(e,e.transformResponse,t),t.headers=y.from(t.headers),t},function(t){return F(t)||(S(e),t&&t.response&&(t.response.data=C.call(e,e.transformResponse,t.response),t.response.headers=y.from(t.response.headers))),Promise.reject(t)})}const I={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{I[e]=function(t){return typeof t===e||"a"+(r<1?"n ":" ")+e}});const N={};I.transitional=function(r,s,t){function n(a,o){return"[Axios v"+L+"] Transitional option '"+a+"'"+o+(t?". "+t:"")}return(a,o,i)=>{if(r===!1)throw new f(n(o," has been removed"+(s?" in "+s:"")),f.ERR_DEPRECATED);return s&&!N[o]&&(N[o]=!0,console.warn(n(o," has been deprecated since v"+s+" and will be removed in the near future"))),r?r(a,o,i):!0}};function G(e,r,s){if(typeof e!="object")throw new f("options must be an object",f.ERR_BAD_OPTION_VALUE);const t=Object.keys(e);let n=t.length;for(;n-- >0;){const a=t[n],o=r[a];if(o){const i=e[a],p=i===void 0||o(i,a,e);if(p!==!0)throw new f("option "+a+" must be "+p,f.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new f("Unknown option "+a,f.ERR_BAD_OPTION)}}var _={assertOptions:G,validators:I};const b=_.validators;class w{constructor(r){this.defaults=r,this.interceptors={request:new M,response:new M}}request(r,s){typeof r=="string"?(s=s||{},s.url=r):s=r||{},s=P(this.defaults,s);const{transitional:t,paramsSerializer:n}=s;t!==void 0&&_.assertOptions(t,{silentJSONParsing:b.transitional(b.boolean),forcedJSONParsing:b.transitional(b.boolean),clarifyTimeoutError:b.transitional(b.boolean)},!1),n!==void 0&&_.assertOptions(n,{encode:b.function,serialize:b.function},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();const a=s.headers&&c.merge(s.headers.common,s.headers[s.method]);a&&c.forEach(["delete","get","head","post","put","patch","common"],function(d){delete s.headers[d]}),s.headers=new y(s.headers,a);const o=[];let i=!0;this.interceptors.request.forEach(function(d){typeof d.runWhen=="function"&&d.runWhen(s)===!1||(i=i&&d.synchronous,o.unshift(d.fulfilled,d.rejected))});const p=[];this.interceptors.response.forEach(function(d){p.push(d.fulfilled,d.rejected)});let m,h=0,R;if(!i){const u=[D.bind(this),void 0];for(u.unshift.apply(u,o),u.push.apply(u,p),R=u.length,m=Promise.resolve(s);h<R;)m=m.then(u[h++],u[h++]);return m}R=o.length;let j=s;for(h=0;h<R;){const u=o[h++],d=o[h++];try{j=u(j)}catch(J){d.call(this,J);break}}try{m=D.call(this,j)}catch(u){return Promise.reject(u)}for(h=0,R=p.length;h<R;)m=m.then(p[h++],p[h++]);return m}getUri(r){r=P(this.defaults,r);const s=B(r.baseURL,r.url);return V(s,r.params,r.paramsSerializer)}}c.forEach(["delete","get","head","options"],function(r){w.prototype[r]=function(s,t){return this.request(P(t||{},{method:r,url:s,data:(t||{}).data}))}});c.forEach(["post","put","patch"],function(r){function s(t){return function(a,o,i){return this.request(P(i||{},{method:r,headers:t?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}w.prototype[r]=s(),w.prototype[r+"Form"]=s(!0)});class H{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(a){s=a});const t=this;this.promise.then(n=>{if(!t._listeners)return;let a=t._listeners.length;for(;a-- >0;)t._listeners[a](n);t._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(i=>{t.subscribe(i),a=i}).then(n);return o.cancel=function(){t.unsubscribe(a)},o},r(function(a,o,i){t.reason||(t.reason=new v(a,o,i),s(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}static source(){let r;return{token:new H(function(n){r=n}),cancel:r}}}function Q(e){return function(s){return e.apply(null,s)}}function Y(e){return c.isObject(e)&&e.isAxiosError===!0}function U(e){const r=new w(e),s=K(w.prototype.request,r);return c.extend(s,w.prototype,r,{allOwnKeys:!0}),c.extend(s,r,null,{allOwnKeys:!0}),s.create=function(n){return U(P(e,n))},s}const l=U(q);l.Axios=w;l.CanceledError=v;l.CancelToken=H;l.isCancel=F;l.VERSION=L;l.toFormData=W;l.AxiosError=f;l.Cancel=l.CanceledError;l.all=function(r){return Promise.all(r)};l.spread=Q;l.isAxiosError=Y;l.formToJSON=e=>$(c.isHTMLForm(e)?new FormData(e):e);var E=l;E.defaults.timeout=25e3;E.defaults.baseURL="";E.interceptors.request.use(e=>{e.data=e.data||{},e.params=e.params||{},e.method==="post"&&e.data.getResHeader&&(delete e.data.getResHeader,e.getResHeader=!0),e.method==="get"&&e.params.getResHeader&&(delete e.params.getResHeader,e.getResHeader=!0);let r=new Date().getTime();if(e.headers["accept-language"]=X.language==="en-US"?"en":"zh-cn",e.headers.Timestamp=r,T.token){let s="uuidv4()",t=e.method==="get"?"":JSON.stringify(e.data)==="{}"?"{}":JSON.stringify(e.data);T.token+r+s+t;let n="CryptoJS.enc.Hex.stringify(sign)";e.headers.Authorization=T.token,e.headers.Signature=n,e.headers["Request-ID"]=s,e.headers.Version="1.0",e.headers["Sign-Method"]="HMAC-SHA256"}return e},e=>{console.log(e),O.show({type:"error",content:e}),Promise.reject(e)});E.interceptors.response.use(e=>{const r=t=>{const{status:n,success:a,msg:o}=t.data;return["88003","88016"].includes(String(n))?(T.ResetToken(),k.push(`/login?redirect=${k.currentRoute.value.path}`),O.show({type:"error",content:o!=null?o:A.defaultErrorMsg}),x.hide(),Promise.reject(n)):(O.show({type:"error",content:o!=null?o:A.defaultErrorMsg}),x.hide(),Promise.reject("error"))},s=t=>(x.hide(),t.config.getResHeader?t.data instanceof Blob?Promise.resolve(Object.assign({blob:t.data},t.headers)):Promise.resolve(Object.assign(t.data,t.headers)):Promise.resolve(t.data));if(e.data instanceof Blob){let t=e;return new Promise(n=>{var a=new FileReader;a.readAsBinaryString(e.data),a.addEventListener("loadend",()=>{a.result.indexOf("status")!==-1?(e.data=JSON.parse(a.result),n(r(e))):n(s(t))})})}else{const{status:t,success:n}=e.data;return!t||!n||!A.succCode.includes(String(t))?r(e):s(e)}},e=>(e.config&&e.config.url.includes("/login")&&(console.info(e),O.show({type:"error",content:A.defaultErrorMsg})),x.hide(),Promise.reject("error")));const Z=E.create({baseURL:"https://api.example.com"});var se=z(({app:e})=>{e.config.globalProperties.$axios=E,e.config.globalProperties.$api=Z});export{Z as api,se as default,E as request};
